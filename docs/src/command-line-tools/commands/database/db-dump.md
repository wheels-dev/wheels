# wheels db dump
> **⚠️ Note:** This command depends on configuration values. Please verify your database configuration before executing it.
## ⚠️ Known Issues

1. This command currently works only with **MySQL and H2**.  
2. Support for **MSSQL** and **PostgreSQL** will be added in future releases.
3. Options (parameters) for this command may not work



Export database schema and data to a file.

## Synopsis

```bash
wheels db dump [--output=<file>] [--datasource=<name>] [--environment=<env>] 
              [--schema-only] [--data-only] [--tables=<list>] [--compress]
```

## Description

The `wheels db dump` command exports your database to a SQL file that can be used for backups, migrations, or setting up new environments. It supports various options for customizing what gets exported.

## Options

### --output=<file>
Output file path. Defaults to `dump_[datasource]_[timestamp].sql`.

```bash
wheels db dump --output=backup.sql
```

### --datasource=<name>
Specify which datasource to dump. If not provided, uses the default datasource.

```bash
wheels db dump --datasource=myapp_prod
```

### --environment=<env>
Specify the environment to use. Defaults to the current environment.

```bash
wheels db dump --environment=production
```

### --schema-only
Export only the database structure (no data).

```bash
wheels db dump --schema-only
```

### --data-only
Export only the data (no structure).

```bash
wheels db dump --data-only
```

### --tables=<list>
Comma-separated list of specific tables to dump.

```bash
wheels db dump --tables=users,posts,comments
```

### --compress
Compress the output file using gzip.

```bash
wheels db dump --compress
```

## Examples

### Basic Backup

Create a timestamped backup:
```bash
wheels db dump
# Creates: dump_myapp_dev_20231204153045.sql
```

### Production Backup

```bash
wheels db dump --environment=production --output=prod-backup.sql --compress
```

### Schema Only Export

For version control:
```bash
wheels db dump --schema-only --output=schema.sql
```

### Specific Tables

Export user-related tables:
```bash
wheels db dump --tables=users,user_roles,user_sessions --output=user-data.sql
```

### Compressed Backup

Save space with compression:
```bash
wheels db dump --output=backup.sql.gz --compress
```

## Database-Specific Behavior

### MySQL/MariaDB
- Uses `mysqldump` utility
- Includes stored procedures and triggers
- Preserves character sets and collations

### PostgreSQL
- Uses `pg_dump` utility
- Includes schemas, functions, and extensions
- Handles permissions and ownership

### SQL Server
- Basic export functionality
- For full backups, use SQL Server Management Studio

### H2
- Uses built-in SCRIPT command
- Exports to SQL script format
- Supports compression natively

## Output Format

The dump file contains:
1. Database structure (CREATE TABLE statements)
2. Indexes and constraints
3. Data (INSERT statements)
4. Views, procedures (if supported)

Example output structure:
```sql
-- Database dump generated by Wheels
-- Date: 2023-12-04 15:30:45

-- Table structure for users
CREATE TABLE users (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(100),
    email VARCHAR(255) UNIQUE
);

-- Data for users
INSERT INTO users (id, name, email) VALUES
(1, 'John Doe', 'john@example.com'),
(2, 'Jane Smith', 'jane@example.com');
```

## Common Use Cases

### Daily Backups

Automated backup script:
```bash
#!/bin/bash
DATE=$(date +%Y%m%d)
wheels db dump --output=backups/daily-$DATE.sql.gz --compress
```

### Before Major Changes

```bash
# Before deployment
wheels db dump --output=pre-deployment-backup.sql

# Deploy changes
# ...

# If something goes wrong
wheels db restore pre-deployment-backup.sql
```

### Environment Sync

```bash
# Export from production
wheels db dump --environment=production --output=prod-data.sql

# Import to staging
wheels db restore prod-data.sql --environment=staging
```

### Data Migration

```bash
# Export specific tables
wheels db dump --tables=legacy_users,legacy_orders --output=migration-data.sql

# Process with migration scripts
# Import to new structure
```

## Performance Considerations

- Large databases may take time to dump
- Use `--compress` to reduce file size
- Consider `--tables` for partial backups
- Off-peak hours for production dumps

## Security Notes

1. **Protect dump files** - They contain sensitive data
2. **Encrypt backups** - Use additional encryption for sensitive data
3. **Secure transfer** - Use secure methods to transfer dumps
4. **Clean up** - Don't leave dump files in public directories

## Troubleshooting

### "mysqldump not found"
Install MySQL client tools:
```bash
# macOS
brew install mysql-client

# Linux
sudo apt-get install mysql-client
```

### "Permission denied"
- Check database user has SELECT permissions
- Ensure write permissions for output directory

### Large Database Issues
- Use `--compress` to reduce size
- Consider table-by-table exports
- Increase timeout settings if needed

## Related Commands

- [`wheels db restore`](db-restore.md) - Restore from dump
- [`wheels db status`](db-status.md) - Check before dump
- [`wheels db shell`](db-shell.md) - Manual export options